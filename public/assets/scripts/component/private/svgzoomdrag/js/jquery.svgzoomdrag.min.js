!function(a){function b(b){!function(){var a=document.createElement("link"),b=require.s.contexts._.config.baseUrl+d+"css/svgzoomdrag.css";a.type="text/css",a.rel="stylesheet",a.href=b,document.getElementsByTagName("head")[0].appendChild(a)}();var c={init:function(b){var d,c=this;c.degree=0,c.isLoad=!1,c.opts=a.data(b,"svgZoomDrag").options,c.buildWrap(b),c.buildAssistive(),c.opts.svgUrl?(d=c.opts.svgUrl,c.loadSVG(d)):c.loadErrorImg()},buildWrap:function(b){var c=this,d=a(b),e='<div id="svg-wrap" class="svg-wrap"></div>';d.append(e),c.$svgWrap=d.find("#svg-wrap")},loadSVG:function(a,b){var c=this;c.xhr&&(c.loadingHide(),c.xhr.abort()),c.loadingShow(),window.setTimeout(function(){c.removeSvgTag(),c.$svgWrap.css("background","none"),c.xhr=d3.text(a,function(a,d){null===a&&c.isSVG(d)?c.finishLoad(d,b):c.loadErrorImg(),c.loadingHide(),c.xhr=null})},1)},finishLoad:function(a,b){var c=this;c.disabledAccistiveTool(!1),c.buildSVG(a),c.addEvents(),c.resetTSR(c.viewport),"function"==typeof b&&b.apply(c,[c.svg]),"function"==typeof c.opts.callbacks.onLoaded&&c.opts.callbacks.onLoaded.apply(c,[c.svg])},loadErrorImg:function(){var a=this,b=a.getNopicPath();a.disabledAccistiveTool(!0),a.$svgWrap.css("background","url("+b+") no-repeat center center")},buildSVG:function(a){var c,b=this,d=a.match(/<svg[^>]*>/i),e=a.match(/<svg[^>]*>([\s\S]*?)<\/svg>/i),f=d+"<g>"+e[1]+" </g> </svg>";b.$svgWrap.append(f),c=b.$svgWrap.find("svg"),b.svg=d3.select(c[0]),b.viewport=b.svg.select("g")},addEvents:function(){var a=this;a.svg.node,a.zoomScale=d3.behavior.zoom().scaleExtent([.5,10]),a.svg.call(a.zoomScale),a.zoomScale.on("zoom",function(){a.zoom(a.viewport)})},zoom:function(a){var b=this,c=b.degree,d=d3.event?d3.event.scale:b.zoomScale.scale(),e=d3.event?d3.event.translate:b.zoomScale.translate();b.setTSR(a,e,d,c)},zoomIn:function(a){if(!(this.zoomScale.scale()+.2>10)){var b=this,c=b.degree,d=b.zoomScale.scale()+.2,e=b.getLocalMatrix(a,d,c);b.zoomScale.scale(d),b.zoomScale.translate([e.e,e.f]),b.zoom(a)}},zoomOut:function(a){if(!(this.zoomScale.scale()-.2<.5)){var b=this,c=b.degree,d=b.zoomScale.scale()-.2,e=b.getLocalMatrix(a,d,c);b.zoomScale.scale(d),b.zoomScale.translate([e.e,e.f]),b.zoom(a)}},setTSR:function(a,b,c,d){a.transition().duration(0).attr("transform","translate("+b+")scale("+c+")rotate("+d+")")},rotate:function(a,b){var c=this,d=c.degree,e=c.zoomScale.scale(),d=1===b?d+30:d-30,f=c.getLocalMatrix(a,e,d);c.setTSR(a,[f.e,f.f],e,d),c.zoomScale.translate([f.e,f.f]),c.degree=d,"function"==typeof c.opts.callbacks.onRotate&&c.opts.callbacks.onRotate.apply(c,[d])},getLocalMatrix:function(a,b,c){var e=a.node().getBBox(),f={cx:e.width/2,cy:e.height/2,dx:(e.width-e.width*b)/2,dy:(e.height-e.height*b)/2},g=new Snap.Matrix(b,0,0,b,f.dx,f.dy),h=g.rotate(c,f.cx,f.cy);return h},resetSVG:function(){self.loadingHide()},resetTSR:function(a){var b=this;b.setTSR(a,[0,0],1,0),b.zoomScale.scale(1),b.zoomScale.translate([0,0]),b.degree=0},setElToCenter:function(a){var b=this,c=b.viewport,d=b.svg.node(),e=b.getPortMargin(d),f=c.node().getCTM(),g=a.getCTM(),h=b.zoomScale.scale(),i=b.degree,j=g.e-f.e,k=g.f-f.f,l=d.getBoundingClientRect(),m=[(l.width/2-e.left-j)/f.a*h,(l.height/2-e.top-k)/f.a*h];b.setTSR(c,m,h,i),b.zoomScale.translate(m)},getPortMargin:function(b){var d;return b.getCTM()?{left:b.getCTM().e,top:b.getCTM().f}:(d=b.getScreenCTM(),{left:d.e-a(b).offset().left,top:d.f-a(b).offset().top})},removeSvgTag:function(){var a=this;a.$svgWrap.find("svg").remove()},loadingShow:function(){var a=this;a.$svgWrap.showLoading({indicatorZIndex:401,overlayZIndex:400})},loadingHide:function(){var a=this;a.$svgWrap.hideLoading()},getScale:function(){var a=this;return a.zoomScale.scale()},getRotate:function(){var a=this;return a.degree},getNopicPath:function(){var a=this,b=a.opts.nopic,c=a.opts.host+"/scripts/"+d+"res/"+b;return c},buildAssistive:function(){var b=this,c=b.getToolTpl();b.$assistive=a(c).show(),b.$svgWrap.append(b.$assistive),b.initAssistiveEvent(),b.assistiveDock()},initAssistiveEvent:function(){var b=this;b.$assistive.on("mousedown",function(a){b.startDragAssistive(a,this)}),b.$assistive.on("click","a:not([class*='disabled'])",function(){var d=b.viewport,e=a(this).attr("data-action");switch(e){case"zoomin":b.zoomIn(d);break;case"zoomout":b.zoomOut(d);break;case"reset":b.resetTSR(d),"function"==typeof b.opts.callbacks.onReset&&b.opts.callbacks.onReset.apply(b,[0]);break;case"leftrotate":b.rotate(d,0);break;case"rightrotate":b.rotate(d,1)}b.opts.callbacks.onToolClick&&b.opts.callbacks.onToolClick.apply(b,[e])})},disabledAccistiveTool:function(a){var b=this,c=b.$assistive.find("[data-action=zoomout]"),d=b.$assistive.find("[data-action=zoomin]"),e=b.$assistive.find("[data-action=reset]"),f=b.$assistive.find("[data-action=leftrotate]"),g=b.$assistive.find("[data-action=rightrotate]");a?(c.removeClass("assistive-tool-zoomout").addClass("assistive-tool-zoomout-disabled"),d.removeClass("assistive-tool-zoomin").addClass("assistive-tool-zoomin-disabled"),e.removeClass("assistive-tool-reset").addClass("assistive-tool-reset-disabled"),f.removeClass("assistive-tool-left-rotate").addClass("assistive-tool-left-rotate-disabled"),g.removeClass("assistive-tool-right-rotate").addClass("assistive-tool-right-rotate-disabled")):(c.removeClass("assistive-tool-zoomout-disabled").addClass("assistive-tool-zoomout"),d.removeClass("assistive-tool-zoomin-disabled").addClass("assistive-tool-zoomin"),e.removeClass("assistive-tool-reset-disabled").addClass("assistive-tool-reset"),f.removeClass("assistive-tool-left-rotate-disabled").addClass("assistive-tool-left-rotate"),g.removeClass("assistive-tool-right-rotate-disabled").addClass("assistive-tool-right-rotate"))},dragMove:function(b,c){a(b).css({left:c.left+"px",top:+c.top+"px"})},getMovePosition:function(a,b){var c=this,d=c.getSizeAndPosition(c.$svgWrap),e=a.pageY-d.offsetTop-b.top,f=a.pageX-d.offsetLeft-b.left;return{top:e,left:f}},getSizeAndPosition:function(a){return{width:a.width(),height:a.height(),top:a.position().top,left:a.position().left,offsetTop:a.offset().top,offsetLeft:a.offset().left}},assistiveDock:function(){var a=this,b=a.opts.dock||"TL",c=a.$svgWrap.height()-a.$assistive.height()-5,d=a.$svgWrap.width()-a.$assistive.width()-5,e=d/2;switch(b){case"TL":a.$assistive.css({left:"5px",top:"5px"});break;case"TC":a.$assistive.css({left:e+"px",top:"5px"});break;case"TR":a.$assistive.css({left:d+"px",top:"5px"});break;case"BL":a.$assistive.css({left:"5px",top:c+"px"});break;case"BC":a.$assistive.css({left:e+"px",top:c+"px"});break;case"BR":a.$assistive.css({left:d+"px",bottom:"0px"})}},startDragAssistive:function(b,c){var d=this,e={},f={},g=d.getSizeAndPosition(d.$svgWrap),h=d.getSizeAndPosition(d.$assistive);e.top=b.pageY-g.offsetTop-h.top,e.left=b.pageX-g.offsetLeft-h.left,a(document).bind({"mousemove.svg":function(a){f=d.movingRange(a,c,e),d.dragMove(c,f),a.preventDefault()},"mouseup.svg":function(){a(this).unbind("mousemove.svg mouseup.svg"),b.preventDefault()}})},getToolTpl:function(){var c=this,d=c.opts.assistiveTool;return a(b).wrap("<div></div>").parent().find("div[data-template-id='"+d+"']").get(0).outerHTML},movingRange:function(b,c,d){var e=this,f=5,g=5,h=e.getMovePosition(b,d),i=e.$svgWrap.width()-a(c).width()-5,j=e.$svgWrap.height()-a(c).height()-5;return h.left<f&&(h.left=f),h.top<g&&(h.top=g),h.left>i&&(h.left=i),h.top>j&&(h.top=j),h},isSVG:function(a){return a.match(/<svg[^>]*>/i)?!0:!1}};a.fn.svgZoomDrag=function(b,d){var e=this;return"string"==typeof b?a.fn.svgZoomDrag.methods[b](d):e.each(function(){a.data(this,"svgZoomDrag",{options:a.extend({},a.fn.svgZoomDrag.defaults,b||{})}),c.init(this)})},a.fn.svgZoomDrag.methods={loadSVG:function(a){var b=a.url,d=a.loaded||null;return c.loadSVG(b,d)},resetTSR:function(a){return c.resetTSR(a)},getScale:function(){return c.getScale()},getRotate:function(){return c.getRotate()},setElToCenter:function(a){return c.setElToCenter(a)}},a.fn.svgZoomDrag.defaults={maxZoom:20,minZoom:.08,dock:"TL",assistiveTool:1,nopic:"nopic.gif",callbacks:{onLoaded:null,onRotate:null,onToolClick:null,onReset:null}}}function c(){var a,b=require.s.contexts._.config,c=b.paths["jquerySvgZoomDrag"];return"undefined"!=typeof c?(a=c.split(/\/+/g),a.slice(0,a.length-2).join("/")+"/"):(alert("require config paths 'jquerySvgZoomDrag' key not exist"),void 0)}if("function"==typeof define&&define.amd&&define.amd.jQuery){var d=c();"undefined"!=typeof d&&define(["text!"+d+"tpl/assistive.htm","d3"],b)}}(jQuery);