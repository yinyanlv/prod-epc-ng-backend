!function(a){function b(){var b={init:function(b){var c=this;c.$target=a(b),c.opts=a.data(b,"svgHotpoint").options,c.buildDomEl(),c.initComponent(b)},buildDomEl:function(){me=this,me.$tbody=a("#"+me.opts.tbodyId)},initComponent:function(){var b=this,d=(b.opts.svg,b.opts.svgUrl||"");b.$target.svgZoomDrag({host:b.opts.host,svgUrl:d,dock:"TL",assistiveTool:3,callbacks:{onLoaded:function(a){b.finishLoaded(a)},onRotate:function(a){b.setCalloutDegree(a)},onReset:function(){b.resetCalloutDegree()},onToolClick:function(a){"function"==typeof b.opts.callbacks.onToolClick&&b.opts.callbacks.onToolClick.apply(b,[a])}}})},finishLoaded:function(a){var b=this;b.svg=a,b.viewport=a.select("g"),b.texts=b.getTexts(),b.setCalloutOriginalPosition(),b.initEvents()},setCalloutOriginalPosition:function(){var b=this;b.texts.each(function(){var b=Snap(this),c=b.transform().localMatrix.toString();a(b.node).css("cursor","pointer"),b.data("data-matrix",c),b.data("data-bbox",b.getBBox())})},initEvents:function(){var b=this;b.texts.on({click:function(){b.selectionCallout(this)},touchstart:function(){b.selectionCallout(this)},mouseover:function(a){b.calloutIn(this,a)},mouseout:function(a){b.calloutOut(this,a)}}),b.$tbody.on("click","tr[data-callout]",function(){var c=a(this).attr("data-callout");b.partsToLegend([c])}),b.$target.contextmenu(function(){return!1})},selectionCallout:function(b){var c=this,e=a(b).text(),f=c.getCalloutTexts([e]);c.highlightCallout(f),"function"==typeof c.opts.callbacks.onSelectionCallout&&c.opts.callbacks.onSelectionCallout.apply(c,[e])},resetCalloutDegree:function(){var a=this;a.texts.each(function(){var a=Snap(this),b=a.data("data-matrix");a.animate({x:0,y:0},0),a.animate({transform:b},0)})},setCalloutDegree:function(a){var b=this;b.texts.each(function(){var b=Snap(this),c=b.data("data-bbox");b.animate({x:c.x,y:c.y+12},0),b.animate({transform:"r"+(a>0?-a:Math.abs(a))+", "+c.cx+", "+c.cy},0)})},partsToLegend:function(a){var b=this,c=b.getCalloutTexts(a);c.length&&c.length>0&&(b.highlightCallout(c),b.calloutIntoView(c))},highlightCallout:function(a){var b=this,c="#E30A0A",d="selected";b.removeCircle(d),a.each(function(){b.appendCircle(this,c,d)})},calloutIntoView:function(a){var b=this,c=b.getCalloutVisible(a),d=b.$target.svgZoomDrag("getScale"),e=b.$target.svgZoomDrag("getRotate");c||(a.length>1||1===d||0!==e?(b.$target.svgZoomDrag("resetTSR",b.viewport),b.resetCalloutDegree()):b.calloutMoveCenter(a.node()))},getCalloutVisible:function(a){var b=this,c=!0;return clientSize=b.svg.node().getBoundingClientRect(),scale=b.$target.svgZoomDrag("getScale"),minLeft=10*scale/2,minTop=10*scale/2,maxLeftRange=clientSize.width-10*scale/2,maxTopRange=clientSize.height-10*scale/2,a.each(function(){var a=b.getNodeSize(this);return a.x<minLeft||a.y<minTop||a.x>maxLeftRange||a.y>maxTopRange?(c=!1,!1):void 0}),c},calloutMoveCenter:function(a){var b=this;b.viewport,b.$target.svgZoomDrag("setElToCenter",a)},getNodeSize:function(a){var b=this,c=a.getBBox(),d=a.getCTM(),e=a.getBoundingClientRect(),f=b.svg.node().getBoundingClientRect();return{x:e.left-f.left,y:e.top-f.top,width:c.width,height:c.height,scale:d.a}},scrollIntoView:function(a){a.scrollIntoView()},changeRowBg:function(b){var c=this;c.resetRowBg(),b.each(function(b,c){var d=a(c).css("background-color");a(c).attr("data-original-color",d)}),b.css("background-color",c.opts.rowBgColor)},resetRowBg:function(){var b=this,c=b.$tbody.find("tr[data-original-color]");c.each(function(b,c){var d=a(c).attr("data-original-color");a(c).css("background-color",d),a(c).removeAttr("data-original-color")})},loadSVG:function(a){var b=this;b.$target.svgZoomDrag("loadSVG",a)},calloutIn:function(b){var c=this,d="temp",e="#FFDD02";a(b).text(),c.appendCircle(b,e,d)},calloutOut:function(){var a=this,b="temp";a.removeCircle(b)},removeCircle:function(b){var c=this;a(c.viewport.node).find('circle[flag="'+b+'"]').remove()},appendCircle:function(a,b,c){var d=this,e=Snap(a).getBBox(),f=d.createCircle(e.cx,e.cy,b,c);d.viewport.node().appendChild(f)},createCircle:function(a,b,c,d){var e=18,f=document.createElementNS("http://www.w3.org/2000/svg","circle");return f.setAttribute("flag",d),f.setAttribute("cx",a),f.setAttribute("cy",b),f.setAttribute("r",e),f.setAttribute("stroke",c),f.setAttribute("stroke-width",3),f.setAttribute("fill","none"),f},getCalloutTexts:function(b){var c=this,d=c.texts.filter(function(){var c=a(this).text();return a.inArray(c,b)>-1});return d},getTexts:function(){var c=this,d=c.svg.selectAll("text").filter(function(){var b=a(this).text();return/^\w{1,3}$/.test(b)});return d}};a.fn.svgHotpoint=function(c,d){var e=this;return"string"==typeof c?a.fn.svgHotpoint.methods[c](d):e.each(function(){a.data(this,"svgHotpoint",{options:a.extend({},a.fn.svgHotpoint.defaults,c||{})}),b.init(this)})},a.fn.svgHotpoint.methods={highlightCallout:function(a){return b.partsToLegend(a)},loadSVG:function(a){return b.loadSVG(a)}},a.fn.svgHotpoint.defaults={maxZoom:20,minZoom:.08,radius:18,rowBgColor:"#ccc",svgUrl:null,dock:"TC",tbodyId:null,callbacks:{onSelectionCallout:null}}}"function"==typeof define&&define.amd&&define.amd.jQuery&&define(["jquerySvgZoomDrag","scrollIntoView"],b)}(jQuery);